!function(){"use strict";function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var t=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.baseNumber=4,this.gutterSize=1,this.finalPositionsArr=[],this.currentPositionsArr=[],this.shuffledPiecesIndexes=[],this.isBoardBlocked=!1,this.userMovements=0,this.minTimes=1,this.maxTimes=80,this.shuffleTimes=20,this.direction={right:1,left:-1,down:this.baseNumber,up:-1*this.baseNumber},this.isModalOpen=!1,this.modalHeaderMsg="",this.modalBodyMsg="",this.isBoardShuffling=!1,this.createFinalPositionsArr()}var i,s;return i=t,(s=[{key:"createFinalPositionsArr",value:function(){for(var e=0;e<this.getPiecesLength();e++)this.finalPositionsArr[e]=e}},{key:"getPiecesLength",value:function(){return this.baseNumber*this.baseNumber}},{key:"getPieceSize",value:function(){return(100-(this.baseNumber-1)*this.gutterSize)/this.baseNumber}},{key:"toggleBoardState",value:function(){this.isBoardBlocked=!this.isBoardBlocked}},{key:"toggleBoardShuffling",value:function(){this.isBoardShuffling=!this.isBoardShuffling}},{key:"updateModalMsg",value:function(){var e="color-success",t=this.userMovements<=1?"move":"moves",i=Math.abs(this.shuffleTimes-this.userMovements);return this.userMovements<this.shuffleTimes?(this.modalHeaderMsg='<h2 class="'.concat(e,'">Amazing!<br> You did ').concat(this.userMovements," ").concat(t,".</h2>"),void(this.modalBodyMsg='<span class="bold">'.concat(i," moves</span> less than the number of moves the board was shuffled with."))):this.userMovements===this.shuffleTimes?(this.modalHeaderMsg='<h2 class="'.concat(e,'">Congrats!<br> You did ').concat(this.userMovements," ").concat(t,".</h2>"),void(this.modalBodyMsg="The exact number of moves as the board was shuffled with.")):(e="color-fail",this.modalHeaderMsg='<h2 class="'.concat(e,'">Ops!<br> You did ').concat(this.userMovements," ").concat(t,".</h2>"),void(this.modalBodyMsg='<span class="bold">'.concat(i," moves</span> more than the number of moves the board was shuffled with.")))}},{key:"populateListOfPossibleChanges",value:function(){var e=this.direction.up,t=this.direction.right,i=this.direction.down,s=this.direction.left,o=this.baseNumber,n=this.getPiecesLength();this.indexesPossibleMovimentsList=[];for(var r=0;r<n;r++){var a=[];r+e>=0&&a.push(e),(r+t)%o>0&&a.push(t),r+i<n&&a.push(i),(r+s)%o>=0&&(r+s)%o<o-1&&a.push(s),this.indexesPossibleMovimentsList.push({number:r,possibleMoviments:a})}}},{key:"shuffledBoardArr",value:function(e){this.shuffledPiecesIndexes=e.map((function(e){return e.number})),this.currentPositionsArr=this.shuffledPiecesIndexes.slice(0)}},{key:"updateCurrentPosition",value:function(e){var t=this.currentPositionsArr.indexOf(e),i=this.currentPositionsArr.indexOf(this.getPiecesLength()-1);this.currentPositionsArr[i]=e,this.currentPositionsArr[t]=this.getPiecesLength()-1}},{key:"incrementUserMovements",value:function(){this.userMovements++}},{key:"resetUserMovements",value:function(){this.userMovements=0}},{key:"toggleModalState",value:function(){this.isModalOpen=!this.isModalOpen}}])&&e(i.prototype,s),Object.defineProperty(i,"prototype",{writable:!1}),t}();function i(e,t,i,s){e.addEventListener(t,i,!!s)}function s(e,t){e.innerHTML=t}function o(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$board=document.getElementById("board"),this.$shuffleInput=document.getElementById("shuffle-input"),this.$playBtns=document.querySelectorAll(".play-game"),this.$counter=document.getElementById("counter"),this.$maxVal=document.getElementById("max-val"),this.$minVal=document.getElementById("min-val"),this.$modal=document.getElementById("modal"),this.$modalHeader=document.getElementById("modal-header"),this.$modalBody=document.getElementById("modal-body"),this.$closeModalEls=document.querySelectorAll(".close-modal")}var t,s;return t=e,(s=[{key:"bindRenderBoard",value:function(e){i(window,"resize",e),i(window,"orientationchange",e)}},{key:"bindCloseModalPressingEsc",value:function(e){i(window,"keydown",e)}},{key:"bindCloseModalOutsideClick",value:function(e){i(this.$modal,"click",e)}},{key:"bindToggleModal",value:function(e){this.$closeModalEls.forEach((function(t){i(t,"click",e)}))}},{key:"bindStartGame",value:function(e){this.$playBtns.forEach((function(t){i(t,"click",e)}))}},{key:"bindSetShuffleTimes",value:function(e){i(this.$shuffleInput,"blur",e)}},{key:"bindShuffleInput",value:function(e){i(this.$shuffleInput,"keydown",e)}},{key:"bindSelectPieceToMove",value:function(e){document.querySelectorAll(".piece").forEach((function(t){i(t,"click",e)}))}},{key:"adjustBoardHeight",value:function(e){this.$board.style.height="".concat(e,"px")}},{key:"getImputVal",value:function(){return this.$shuffleInput.value}},{key:"setInputVal",value:function(e){this.$shuffleInput.value=e.toString()}},{key:"renderPiece",value:function(e,t,i){var s=e+1,o=(Math.floor(e/t),document.createElement("div"));o.classList.add("piece"),o.style.width="".concat(i,"%"),o.style.height="".concat(i,"%"),o.setAttribute("data-index",e),o.innerHTML=s,this.$board.appendChild(o)}},{key:"alocatePieces",value:function(e,t,i,s){for(var o=document.querySelectorAll(".piece"),n=0;n<e.length;n++){var r=e.indexOf(n)%t,a=Math.floor(e.indexOf(n)/t);o[n].style.left="".concat(r*(i+s),"%"),o[n].style.top="".concat(a*(i+s),"%"),o[n].setAttribute("data-current-x",r),o[n].setAttribute("data-current-y",a)}}},{key:"toggleBoardClassName",value:function(e){this.$board.classList[e?"add":"remove"]("board-blocked")}},{key:"movePiece",value:function(e){var t=document.querySelector('[data-index="'.concat(e,'"]')),i=this.$board.lastChild,s=t.style.top,o=t.style.left,n=Number(t.getAttribute("data-current-x")),r=Number(t.getAttribute("data-current-y"));t.style.top=i.style.top,t.style.left=i.style.left,t.setAttribute("data-current-x",Number(i.getAttribute("data-current-x"))),t.setAttribute("data-current-y",Number(i.getAttribute("data-current-y"))),i.style.top=s,i.style.left=o,i.setAttribute("data-current-x",n),i.setAttribute("data-current-y",r)}},{key:"toggleModal",value:function(e){this.$modal.classList[e?"add":"remove"]("modal-is-open")}}])&&o(t.prototype,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();function r(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}new(function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.model=t,this.view=i,i.bindSetShuffleTimes(this.setShuffleTimes.bind(this)),i.bindShuffleInput(this.confirmShuffleOnInput.bind(this)),i.bindStartGame(this.startGame.bind(this)),i.bindToggleModal(this.toggleModal.bind(this)),i.bindCloseModalOutsideClick(this.closeModalOutsideClick.bind(this)),i.bindCloseModalPressingEsc(this.closeModalPressingEsc.bind(this)),i.bindRenderBoard(this.renderBoard.bind(this)),i.setInputVal(this.getShuffleTimes()),this.render()}var t,i;return t=e,(i=[{key:"render",value:function(){this.renderBoard(),this.renderPieces(),s(this.view.$maxVal,this.model.maxTimes),s(this.view.$minVal,this.model.minTimes),this.view.alocatePieces(this.model.finalPositionsArr,this.model.baseNumber,this.model.getPieceSize(),this.model.gutterSize),this.toggleBoardLock()}},{key:"closeModalPressingEsc",value:function(e){27===e.keyCode&&this.getModalState()&&this.toggleModal()}},{key:"closeModalOutsideClick",value:function(e){e.target===e.currentTarget&&this.toggleModal()}},{key:"confirmShuffleOnInput",value:function(e){13===e.keyCode&&(e.preventDefault(),this.setShuffleTimes(),this.startGame(),e.target.blur())}},{key:"renderBoard",value:function(){this.view.adjustBoardHeight(this.getBoardSize())}},{key:"getBoardSize",value:function(){return this.view.$board.offsetWidth}},{key:"renderPieces",value:function(){for(var e=0;e<this.model.getPiecesLength();e++)this.view.renderPiece(e,this.model.baseNumber,this.model.getPieceSize());this.view.bindSelectPieceToMove(this.selectPieceToMove.bind(this))}},{key:"selectPieceToMove",value:function(e){if(!this.isBoardBlocked()&&!this.isBoardShuffling()){var t=e.currentTarget,i=this.view.$board.lastChild,s=Number(t.getAttribute("data-current-x")),o=Number(t.getAttribute("data-current-y")),n=Number(i.getAttribute("data-current-x")),r=Number(i.getAttribute("data-current-y"));if(s-n==0&&1===Math.abs(o-r)||o-r==0&&1===Math.abs(s-n)){var a=Number(t.getAttribute("data-index"));this.view.movePiece(a),this.updateCounter(),this.checkBoardState(a)}}}},{key:"toggleBoardLock",value:function(){this.model.toggleBoardState(),this.view.toggleBoardClassName(this.model.isBoardBlocked)}},{key:"setShuffleTimes",value:function(){var e=Number(this.view.getImputVal());e>this.model.maxTimes&&(e=this.model.maxTimes),e<=this.model.minTimes&&(e=this.model.minTimes),this.model.shuffleTimes=e,this.view.setInputVal(this.model.shuffleTimes)}},{key:"startGame",value:function(){this.model.isBoardShuffling||(this.model.isModalOpen&&this.toggleModal(),this.model.isBoardBlocked&&this.toggleBoardLock(this.model.isBoardBlocked),this.model.populateListOfPossibleChanges(),this.view.alocatePieces(this.model.finalPositionsArr,this.model.baseNumber,this.model.getPieceSize(),this.model.gutterSize),this.shufflePieces(),this.resetConter())}},{key:"updateCounter",value:function(){this.model.incrementUserMovements(),s(this.view.$counter,this.model.userMovements)}},{key:"shufflePieces",value:function(){var e=this,t=0,i=this.model.getPiecesLength()-1,s=[this.model.direction.left,this.model.direction.up][Math.floor(2*Math.random())],o=this.model.indexesPossibleMovimentsList,n=this.model.shuffleTimes;this.model.toggleBoardShuffling();var r=setInterval((function(){if(t!==n){var a=o[i].possibleMoviments.filter((function(e){return e!==-1*s}));s=a[Math.floor(Math.random()*a.length)];var l=i+s;e.view.movePiece(o[l].number);var u=o[i].number,d=o[l].number;o[i].number=d,o[l].number=u,i=l,t++}else clearInterval(r),e.model.shuffledBoardArr(o),e.model.toggleBoardShuffling()}),40)}},{key:"resetConter",value:function(){this.model.resetUserMovements(),s(this.view.$counter,this.model.userMovements)}},{key:"checkBoardState",value:function(e){this.model.updateCurrentPosition(e),this.isBoardOrganized()&&(this.toggleBoardLock(),this.model.updateModalMsg(),s(this.view.$modalHeader,this.model.modalHeaderMsg),s(this.view.$modalBody,this.model.modalBodyMsg),this.toggleModal())}},{key:"isBoardBlocked",value:function(){return this.model.isBoardBlocked}},{key:"isBoardShuffling",value:function(){return this.model.isBoardShuffling}},{key:"isBoardOrganized",value:function(){return JSON.stringify(this.model.currentPositionsArr)===JSON.stringify(this.model.finalPositionsArr)}},{key:"toggleModal",value:function(){this.model.toggleModalState(),this.view.toggleModal(this.model.isModalOpen)}},{key:"getModalState",value:function(){return this.model.isModalOpen}},{key:"getShuffleTimes",value:function(){return this.model.shuffleTimes}}])&&r(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}())(new t,new n)}();